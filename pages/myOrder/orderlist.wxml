<!--pages/myOrder/orderlist.wxml-->
<wxs src="./orderlist.wxs" module="utils" />
<view class="container">
  <view class="order-list">
    <block wx:for="{{orderList}}" wx:key="index">
      <view class="order-item {{ item.status === 'PAIDED' ? 'paided' :  ''}} {{ index === targetOrderIndex ? 'target-order' : '' }}" bindtap="onOrderItemClick" data-order="{{item}}">
        <view class="order-header">
          <text class="order-time">åˆ›å»ºæ—¶é—´: {{utils.formatTime(item.createTime)}}</text>
          <text class="order-time">{{item.order_type === 'RUSH' ? 'ç•…æ‰“è®¢å•' : 'æ™®é€šè®¢åœº'}}</text>
        </view>
        <view class="order-content">
          <view class="order-main">
            <view class="court-list">
              <view class="campus-info" wx:if="{{item.campus}}">
                <text class="campus-label">æ ¡åŒº: </text>
                <text class="campus-name">{{item.campus}}</text>
              </view>
              <block wx:for="{{item.court_ids}}" wx:for-item="court" wx:key="*this">
                <view class="court-module">
                  <text class="court-icon">ğŸ¾</text>
                  <text>{{court}}</text>
                </view>
              </block>
            </view>
            <view class="order-actions">
              <block wx:if="{{item.status === 'PENDING'}}">
                <view class="action-btn pay-btn" catchtap="onPayClick" data-order="{{item}}" wx:if="{{!isAdmin}}">ç»§ç»­æ”¯ä»˜</view>
                <view class="action-btn cancel-btn" catchtap="onCancelClick" data-order="{{item}}" wx:if="{{item.order_type !== 'RUSH'}}">å–æ¶ˆ</view>
              </block>
              <block wx:elif="{{item.status === 'PAIDED' && (item.order_type === 'RUSH' ? item.canRefund : utils.isOrderWithinOneDay(item.court_ids))}}">
                <view class="action-btn refund-btn" catchtap="onRefundClick" data-order="{{item}}" wx:if="{{!isAdmin}}">é€€æ¬¾</view>
              </block>
            </view>
          </view>
          <view class="order-details">
            <text class="total-fee">æ€»ä»·: ï¿¥{{item.total_fee}}</text>
            <text class="status">çŠ¶æ€: {{item.status === 'PENDING' ? 'å¾…æ”¯ä»˜' : item.status === 'PAIDED' ? 'å·²æ”¯ä»˜' : item.status}}</text>
          </view>
        </view>
      </view>
    </block>
  </view>
  <view class="pagination">
    <button bindtap="prevPage" disabled="{{pageNum <= 1}}">ä¸Šä¸€é¡µ</button>
    <text>ç¬¬ {{pageNum}} é¡µ</text>
    <button bindtap="nextPage" disabled="{{!hasMore}}">ä¸‹ä¸€é¡µ</button>
  </view>
  <view wx:if="{{!hasMore}}" class="no-more">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</view>
</view>
